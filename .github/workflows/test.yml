name: tests
on: [push]
jobs:
  bootstrap:
    runs-on: macos-14
    timeout-minutes: 60
    steps:
    - uses: actions/checkout@v4
    - name: Link to home
      run: ln -s "$PWD" "$HOME/.dotfiles"
    - name: Print Homebrew configuration
      run: brew config
    - run: brew install asdf
    - name: Bootstrap
      run: ./scripts/bootstrap
      env:
        # skip updates/upgrades to speed up install
        HOMEBREW_NO_INSTALL_UPGRADE: '1'
        # skip deps installed without homebrew in https://github.com/actions/virtual-environments/blob/main/images/macos/macos-10.15-Readme.md
        HOMEBREW_BUNDLE_BREW_SKIP: >
          awscli
          go
          golangci-lint
          kubernetes-cli
          kubectx
          minikube
          python
          python@3.11
          python@3.12
  shellcheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ludeeus/action-shellcheck@cd81f4475ab741e097ec0fe73b692f3e49d66b8c
        env:
          SHELLCHECK_OPTS: -e SC1071
